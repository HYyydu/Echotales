<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Echotales - Admin Panel</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          sans-serif;
        background: #f9fafb;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        color: #0f172a;
        margin-bottom: 30px;
      }

      .panel {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      h2 {
        color: #0f172a;
        margin-bottom: 20px;
        font-size: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        color: #475569;
        font-weight: 500;
        margin-bottom: 8px;
      }

      input[type="text"],
      input[type="file"],
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
      }

      textarea {
        min-height: 150px;
        resize: vertical;
      }

      .button {
        background: #f9dad2;
        border: 2px solid #f5b5a8;
        color: #0f172a;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .button:hover {
        background: #f5b5a8;
      }

      .button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .button-secondary {
        background: white;
        border: 2px solid #e5e7eb;
        color: #475569;
      }

      .button-secondary:hover {
        background: #f9fafb;
      }

      .books-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .book-item {
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        position: relative;
      }

      .book-item img {
        width: 100%;
        aspect-ratio: 2/3;
        object-fit: cover;
        border-radius: 8px;
        background: #f3f4f6;
        margin-bottom: 12px;
      }

      .book-item h3 {
        font-size: 14px;
        margin-bottom: 4px;
        color: #0f172a;
      }

      .book-item p {
        font-size: 12px;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .book-item .tags {
        display: flex;
        gap: 4px;
        flex-wrap: wrap;
      }

      .tag {
        background: #f9dad2;
        color: #6b4c41;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
      }

      .delete-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(239, 68, 68, 0.9);
        color: white;
        border: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 14px;
      }

      .delete-btn:hover {
        background: #dc2626;
      }

      .status-message {
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .success {
        background: #d4f4dd;
        color: #16a34a;
      }

      .error {
        background: #fee2e2;
        color: #dc2626;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üìö Echotales - Admin Panel</h1>

      <!-- Firebase Setup Instructions -->
      <div class="panel">
        <h2>üîß Firebase Setup Required</h2>
        <p style="color: #475569; line-height: 1.6">
          Before using this admin panel, you need to set up Firebase:<br /><br />
          1. Go to
          <a
            href="https://console.firebase.google.com"
            target="_blank"
            style="color: #f5b5a8"
            >Firebase Console</a
          ><br />
          2. Create a new project or use an existing one<br />
          3. Enable Firestore Database and Storage<br />
          4. Get your Firebase config and update
          <code>src/config/firebase.js</code><br />
          5. For iOS: Download GoogleService-Info.plist and replace the existing
          file<br /><br />
          <strong>Note:</strong> This panel will not work until Firebase is
          configured.
        </p>
      </div>

      <!-- Upload Book Form -->
      <div class="panel">
        <h2>‚ûï Add New Book</h2>
        <div id="statusMessage"></div>

        <form id="uploadForm">
          <div class="form-group">
            <label>Book Title *</label>
            <input
              type="text"
              id="title"
              required
              placeholder="The Secret Garden"
            />
          </div>

          <div class="form-group">
            <label>Author *</label>
            <input
              type="text"
              id="author"
              required
              placeholder="Frances Hodgson Burnett"
            />
          </div>

          <div class="form-group">
            <label>Age Group *</label>
            <select id="age" required>
              <option value="">Select age group</option>
              <option value="0-3">0-3 years</option>
              <option value="4-6">4-6 years</option>
              <option value="7-9">7-9 years</option>
              <option value="10-12">10-12 years</option>
              <option value="13+">13+ years</option>
            </select>
          </div>

          <div class="form-group">
            <label>Genre *</label>
            <select id="genre" required>
              <option value="">Select genre</option>
              <option value="Adventure">Adventure</option>
              <option value="Fantasy">Fantasy</option>
              <option value="Fairy Tales">Fairy Tales</option>
              <option value="Animals">Animals</option>
              <option value="Science">Science</option>
              <option value="Mystery">Mystery</option>
              <option value="Friendship">Friendship</option>
              <option value="Family">Family</option>
            </select>
          </div>

          <div class="form-group">
            <label>Tags (comma-separated)</label>
            <input
              type="text"
              id="tags"
              placeholder="Bestseller, Classic, Award Winner"
            />
          </div>

          <div class="form-group">
            <label>Book Cover *</label>
            <input type="file" id="cover" accept="image/*" required />
          </div>

          <div class="form-group">
            <label>Book Content (Full Text)</label>
            <textarea id="content" placeholder="Once upon a time..."></textarea>
          </div>

          <button type="submit" class="button">Upload Book</button>
        </form>
      </div>

      <!-- Books List -->
      <div class="panel">
        <h2>üìñ Manage Books</h2>
        <button id="loadBooks" class="button button-secondary">
          Load Books
        </button>
        <div id="booksList" class="books-list"></div>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
        deleteDoc,
        doc,
        updateDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import {
        getStorage,
        ref,
        uploadBytes,
        getDownloadURL,
        deleteObject,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCPEIaMSj8PYggVxDVOkyNL0MTGiyrD9vg",
        authDomain: "echotales-d23cc.firebaseapp.com",
        databaseURL: "https://echotales-d23cc-default-rtdb.firebaseio.com",
        projectId: "echotales-d23cc",
        storageBucket: "echotales-d23cc.firebasestorage.app",
        messagingSenderId: "377842214787",
        appId: "1:377842214787:web:e5b8088c9369b23a1178b6",
        measurementId: "G-SLH6TW4KEF",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const storage = getStorage(app);

      // Status message helper
      function showStatus(message, isError = false) {
        const statusDiv = document.getElementById("statusMessage");
        statusDiv.innerHTML = `<div class="status-message ${
          isError ? "error" : "success"
        }">${message}</div>`;
        setTimeout(() => {
          statusDiv.innerHTML = "";
        }, 5000);
      }

      // Upload book form
      document
        .getElementById("uploadForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          try {
            const title = document.getElementById("title").value;
            const author = document.getElementById("author").value;
            const age = document.getElementById("age").value;
            const genre = document.getElementById("genre").value;
            const tagsInput = document.getElementById("tags").value;
            const tags = tagsInput
              .split(",")
              .map((t) => t.trim())
              .filter((t) => t);
            const coverFile = document.getElementById("cover").files[0];
            const content = document.getElementById("content").value;

            if (!coverFile) {
              showStatus("Please select a book cover image", true);
              return;
            }

            // Create book document
            const docRef = await addDoc(collection(db, "books"), {
              title,
              author,
              age,
              genre,
              tags,
              textContent: content,
              coverUrl: "",
              createdAt: new Date(),
            });

            // Upload cover
            const storageRef = ref(storage, `book-covers/${docRef.id}.jpg`);
            await uploadBytes(storageRef, coverFile);
            const coverUrl = await getDownloadURL(storageRef);

            // Update book with cover URL
            await updateDoc(doc(db, "books", docRef.id), { coverUrl });

            showStatus("‚úÖ Book uploaded successfully!");
            e.target.reset();

            // Reload books list
            loadBooks();
          } catch (error) {
            console.error("Error uploading book:", error);
            showStatus(`‚ùå Error: ${error.message}`, true);
          }
        });

      // Load books
      async function loadBooks() {
        try {
          const querySnapshot = await getDocs(collection(db, "books"));
          const booksListDiv = document.getElementById("booksList");

          if (querySnapshot.empty) {
            booksListDiv.innerHTML =
              '<p style="color: #6B7280; text-align: center; padding: 40px;">No books found. Upload your first book!</p>';
            return;
          }

          booksListDiv.innerHTML = "";

          querySnapshot.forEach((doc) => {
            const book = doc.data();
            const bookDiv = document.createElement("div");
            bookDiv.className = "book-item";
            bookDiv.innerHTML = `
                        <button class="delete-btn" data-id="${
                          doc.id
                        }" data-cover="${book.coverUrl}">√ó</button>
                        <img src="${book.coverUrl}" alt="${
              book.title
            }" onerror="this.style.display='none'">
                        <h3>${book.title}</h3>
                        <p>${book.author}</p>
                        <p style="font-size: 11px;">Age: ${book.age} | Genre: ${
              book.genre
            }</p>
                        <div class="tags">
                            ${
                              book.tags
                                ?.map(
                                  (tag) => `<span class="tag">${tag}</span>`
                                )
                                .join("") || ""
                            }
                        </div>
                    `;
            booksListDiv.appendChild(bookDiv);
          });

          // Add delete listeners
          document.querySelectorAll(".delete-btn").forEach((btn) => {
            btn.addEventListener("click", async (e) => {
              const bookId = e.target.dataset.id;
              const coverUrl = e.target.dataset.cover;

              if (!confirm("Are you sure you want to delete this book?"))
                return;

              try {
                // Delete cover from storage
                if (coverUrl) {
                  const storageRef = ref(storage, coverUrl);
                  await deleteObject(storageRef);
                }

                // Delete document
                await deleteDoc(doc(db, "books", bookId));

                showStatus("Book deleted successfully");
                loadBooks();
              } catch (error) {
                console.error("Error deleting book:", error);
                showStatus(`Error deleting book: ${error.message}`, true);
              }
            });
          });
        } catch (error) {
          console.error("Error loading books:", error);
          showStatus(`Error loading books: ${error.message}`, true);
        }
      }

      // Load books button
      document.getElementById("loadBooks").addEventListener("click", loadBooks);

      // Load books on page load
      window.addEventListener("load", () => {
        // Uncomment after Firebase is configured
        // loadBooks();
      });
    </script>
  </body>
</html>
